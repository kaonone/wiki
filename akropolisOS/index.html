



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Wiki for the Akropolis Project">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>AkropolisOS - Akropolis wiki</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ab47bc">
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Overpass:300,400,400i,700|Overpass+Mono">
        <style>body,input{font-family:"Overpass","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Overpass Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-141608436-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="purple" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#akropolisos" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Akropolis wiki" class="md-header-nav__button md-logo">
          
            <img src="../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Akropolis wiki
            </span>
            <span class="md-header-nav__topic">
              AkropolisOS
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/akropolisio/wiki/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    akropolisio/wiki
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Akropolis wiki" class="md-nav__button md-logo">
      
        <img src="../images/logo.svg" width="48" height="48">
      
    </a>
    Akropolis wiki
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/akropolisio/wiki/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    akropolisio/wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Products
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Products
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="AkropolisOS" class="md-nav__link md-nav__link--active">
      AkropolisOS
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sparta/" title="Sparta" class="md-nav__link">
      Sparta
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spartafaq/" title="Sparta FAQ" class="md-nav__link">
      Sparta FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../delphi/" title="Delphi" class="md-nav__link">
      Delphi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../simplefaq/" title="Simple Staking FAQ" class="md-nav__link">
      Simple Staking FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../delphifaq/" title="Delphi FAQ" class="md-nav__link">
      Delphi FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Open Source Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Open Source Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../polkahub/" title="Polkahub" class="md-nav__link">
      Polkahub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../c2fc/" title="C2FC" class="md-nav__link">
      C2FC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bridge/" title="Ethereum-Substrate Bridge" class="md-nav__link">
      Ethereum-Substrate Bridge
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../web3walletkit/" title="Web3WalletKit" class="md-nav__link">
      Web3WalletKit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stakingportal/" title="Staking Portal" class="md-nav__link">
      Staking Portal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Tokenomics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tokenomics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../akro/" title="AKRO" class="md-nav__link">
      AKRO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adel/" title="ADEL" class="md-nav__link">
      ADEL
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../team/" title="Team" class="md-nav__link">
      Team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../partners/" title="Partners & Friends" class="md-nav__link">
      Partners & Friends
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../design/" title="Design" class="md-nav__link">
      Design
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Blog Posts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Blog Posts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../blog/2020/" title="2020" class="md-nav__link">
      2020
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blog/2019/" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blog/2018/" title="2018" class="md-nav__link">
      2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../press/" title="Media Coverage" class="md-nav__link">
      Media Coverage
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Research & Links
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Research & Links
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../defi/" title="DeFi" class="md-nav__link">
      DeFi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://airtable.com/shrrKv18TLgDZCnMp" title="Pension Crises Knowledge Base" class="md-nav__link">
      Pension Crises Knowledge Base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://airtable.com/shrtSK8Uc2PweuEwk" title="Informal Savings Knowledge Base" class="md-nav__link">
      Informal Savings Knowledge Base
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/akropolisio/wiki/edit/master/docs/akropolisOS.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="akropolisos">AkropolisOS</h1>
<p>AkropolisOS is A Solidity framework for building complex dApps and protocols (savings, pensions, loans, investments). </p>
<p>AkropolisOS is a framework for creating and managing distributed digital financial organisations. Anybody can use AkropolisOS to set up and collectively manage distributed capital pools with customisable user incentives, automated liquidity provision enabled by the bonding curve mechanism, and programmatic liquidity and treasury management. Designed as an upgradeable modular framework based on OpenZeppelin, AkropolisOS provides lego-like scalability without the loss of coherence and security.</p>
<p><a href="https://wiki.akropolis.io/sparta/">Sparta</a> is an undercollaterized credit pool based on AkropolisOS, where members of which can earn high-interest rates by providing undercollateralized loans to other members and by pooling and investing capital through various liquid DeFi instruments.</p>
<p><a href="https://wiki.akropolis.io/delphi/">Delphi</a> is a yield farming aggregator with dollar cost averaging tooling. Delphi allows users to gain yield on synthetic savings, farm tokens from integrated protocols/pools, and invest in volatile assets using an active “all in” approach or a passive dollar cost averaging strategy.</p>
<p><a href="github.com/akropolisio">Link</a> to the Github repo.</p>
<h1 id="mainnet-deployment">Mainnet deployment</h1>
<ul>
<li>DAI: <a href="https://etherscan.io/address/0x6b175474e89094c44da98b954eedeac495271d0f">0x6b175474e89094c44da98b954eedeac495271d0f</a></li>
<li>Pool: <a href="https://etherscan.io/address/0x73067fdd366Cb678E9b539788F4C0f34C5700246">0x73067fdd366Cb678E9b539788F4C0f34C5700246</a></li>
<li>AccessModule: <a href="https://etherscan.io/address/0xfE7B0aeb84D134c5be6b217e51B2b040F5B7cB7B">0xfE7B0aeb84D134c5be6b217e51B2b040F5B7cB7B</a></li>
<li>PToken: <a href="https://etherscan.io/address/0xAA2edc0E5CDE4Da80628972c501e79326741dB17">0xAA2edc0E5CDE4Da80628972c501e79326741dB17</a></li>
<li>CurveModule: <a href="https://etherscan.io/address/0xFb6b0103063CDf701b733db3Fa3F1c0686F19668">0xFb6b0103063CDf701b733db3Fa3F1c0686F19668</a></li>
<li>FundsModule: <a href="https://etherscan.io/address/0xc88F54A79CaE4C125D7A8c2Cf811daaE78b07D64">0xc88F54A79CaE4C125D7A8c2Cf811daaE78b07D64</a></li>
<li>LiquidityModule: <a href="https://etherscan.io/address/0x543cBc6693f8cBCf0AE5f2cfd9922203cc13b10A">0x543cBc6693f8cBCf0AE5f2cfd9922203cc13b10A</a></li>
<li>LoanLimitsModule: <a href="https://etherscan.io/address/0x42b41f636C9eBB150F859f65e3c0f938b0347f59">0x42b41f636C9eBB150F859f65e3c0f938b0347f59</a></li>
<li>LoanProposalsModule: <a href="https://etherscan.io/address/0xd3bdEdA5e165E67985a4Dc7927E4651Bedd1950c">0xd3bdEdA5e165E67985a4Dc7927E4651Bedd1950c</a></li>
<li>LoanModule: <a href="https://etherscan.io/address/0x42E24De51db5baf6E18F91619195375FBAe63b13">0x42E24De51db5baf6E18F91619195375FBAe63b13</a></li>
</ul>
<h2 id="developer-tools">Developer tools</h2>
<ul>
<li><a href="https://openzeppelin.com/sdk/">Openzeppelin SDK</a></li>
<li><a href="https://openzeppelin.com/contracts/">Openzepplin Contracts</a></li>
<li><a href="https://www.trufflesuite.com/">Truffle</a></li>
</ul>
<h2 id="diagrams">Diagrams</h2>
<h3 id="modules">Modules</h3>
<p><img alt="Modules" src="/images/development/akropolisos/diagram_modules.png" /></p>
<h3 id="user-interactions">User Interactions</h3>
<p><img alt="User Interactions" src="/images/development/akropolisos/diagram_user_interactions.png" /></p>
<h2 id="deployment">Deployment</h2>
<h3 id="required-data">Required data:</h3>
<ul>
<li>Address of liquidity token (<code>LToken.address</code>)</li>
</ul>
<h3 id="deployment-sequence">Deployment sequence:</h3>
<ol>
<li>Pool</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize()</code></li>
<li>Liquidity token</li>
<li>Register in pool: <code>Pool.set("ltoken", LToken.address)</code>    </li>
<li>PToken</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("ptoken", PToken.address)</code></li>
<li>CurveModule</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("curve", CurveModule.address)</code></li>
<li>AccessModule</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("access", CurveModule.address)</code></li>
<li>LiquidityModule</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("liquidity", LiquidityModule.address)</code></li>
<li>LoanModule, LoanLimitsModule, LoanProposalsModule</li>
<li>Deploy proxy and contract instance of LoanLimitsModule</li>
<li>Call <code>LoanLimitsModule.initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("loan_limits", LoanLimitsModule.address)</code></li>
<li>Deploy proxy and contract instance of LoanProposalsModule</li>
<li>Call <code>LoanProposalsModule.initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("loan_proposals", LoanProposalsModule.address)</code></li>
<li>Deploy proxy and contract instance of LoanModule</li>
<li>Call <code>LoanModule.initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("loan", LoanModule.address)</code></li>
<li>FundsModule</li>
<li>Deploy proxy and contract instance</li>
<li>Call <code>initialize(Pool.address)</code></li>
<li>Register in pool: <code>Pool.set("funds", FundsModule.address)</code></li>
<li>Add LiquidityModule as FundsOperator: <code>FundsModule.addFundsOperator(LiquidityModule.address)</code></li>
<li>Add LoanModule as FundsOperator: <code>FundsModule.addFundsOperator(LoanModule.address)</code></li>
<li>Add FundsModule as a Minter for PToken: <code>PToken.addMinter(FundsModule.address)</code></li>
</ol>
<h2 id="liquidity">Liquidity</h2>
<h3 id="deposit">Deposit</h3>
<h4 id="required-data_1">Required data:</h4>
<ul>
<li><code>lAmount</code>: Deposit amount, DAI</li>
</ul>
<h4 id="required-conditions">Required conditions:</h4>
<ul>
<li>All contracts are deployed</li>
</ul>
<h4 id="workflow">Workflow:</h4>
<ol>
<li>Call <code>FundsModule.calculatePoolEnter(lAmount)</code> to determine expected PTK amount (<code>pAmount</code>)</li>
<li>Determine minimum acceptable amount of PTK <code>pAmountMin &lt;= pAmount</code>, which user expects to get when deposit <code>lAmount</code> of DAI. Zero value is allowed.</li>
<li>Call <code>LToken.approve(FundsModule.address, lAmount)</code> to allow exchange</li>
<li>Call <code>LiquidityModule.deposit(lAmount, pAmountMin)</code> to execute exchange</li>
</ol>
<h3 id="withdraw">Withdraw</h3>
<h4 id="required-data_2">Required data:</h4>
<ul>
<li><code>pAmount</code>: Withdraw amount, PTK</li>
</ul>
<h4 id="required-conditions_1">Required conditions:</h4>
<ul>
<li>Available liquidity <code>LToken.balanceOf(FundsModule.address)</code> is greater than expected amount of DAI</li>
<li>User has enough PTK: <code>PToken.balanceOf(userAddress) &gt;= pAmount</code></li>
</ul>
<h4 id="workflow_1">Workflow:</h4>
<ol>
<li>Call <code>FundsModule.calculatePoolExitInverse(pAmount)</code> to determine expected amount of DAI (<code>lAmount</code>). The response has 3 values, use the second one.</li>
<li>Determine minimum acceptable amount <code>lAmountMin &lt;= lAmount</code> of DAI , which user expects to get when deposit <code>pAmount</code> of PTK. Zero value is allowed.</li>
<li>Call <code>PToken.approve(FundsModule.address, pAmount)</code> to allow exchange</li>
<li>Call <code>LiquidityModule.withdraw(pAmount, lAmountMin)</code> to execute exchange</li>
</ol>
<h2 id="credits">Credits</h2>
<h3 id="create-loan-request">Create Loan Request</h3>
<h4 id="required-data_3">Required data:</h4>
<ul>
<li><code>debtLAmount</code>: Loan amount, DAI</li>
<li><code>interest</code>: Interest rate, percents</li>
<li><code>pAmountMax</code>: Maximal amount of PTK to use as borrower's own pledge</li>
<li><code>descriptionHash</code>: Hash of loan description stored in Swarm</li>
</ul>
<h4 id="required-conditions_2">Required conditions:</h4>
<ul>
<li>User has enough PTK: <code>PToken.balanceOf(userAddress) &gt;= pAmount</code></li>
</ul>
<h4 id="workflow_2">Workflow:</h4>
<ol>
<li>Call <code>FundsModule.calculatePoolExitInverse(pAmount)</code> to determine expected pledge in DAI (<code>lAmount</code>). The response has 3 values, use the first one.</li>
<li>Determine minimum acceptable amount <code>lAmountMin &lt;= lAmount</code> of DAI, which user expects to lock as a pledge, sending <code>pAmount</code> of PTK. Zero value is allowed.</li>
<li>Call <code>PToken.approve(FundsModule.address, pAmount)</code> to allow operation.</li>
<li>Call <code>LoanModule.createDebtProposal(debtLAmount, interest, pAmountMax, descriptionHash)</code> to create loan proposal.</li>
</ol>
<h4 id="data-required-for-future-calls">Data required for future calls:</h4>
<ul>
<li>Proposal index: <code>proposalIndex</code> from event <code>DebtProposalCreated</code>.</li>
</ul>
<h3 id="add-pledge">Add Pledge</h3>
<h4 id="required-data_4">Required data:</h4>
<ul>
<li>Loan proposal identifiers:</li>
<li><code>borrower</code> Address of borrower</li>
<li><code>proposal</code> Proposal index</li>
<li><code>pAmount</code>  Pledge amount, PTK</li>
</ul>
<h4 id="required-conditions_3">Required conditions:</h4>
<ul>
<li>Loan proposal created</li>
<li>Loan proposal not yet executed</li>
<li>Loan proposal is not yet fully filled: <code>LoanModule.getRequiredPledge(borrower, proposal) &gt; 0</code></li>
<li>User has enough PTK: <code>PToken.balanceOf(userAddress) &gt;= pAmount</code></li>
</ul>
<h4 id="workflow_3">Workflow:</h4>
<ol>
<li>Call <code>FundsModule.calculatePoolExitInverse(pAmount)</code> to determine expected pledge in DAI (<code>lAmount</code>). The response has 3 values, use the first one.</li>
<li>Determine minimum acceptable amount <code>lAmountMin &lt;= lAmount</code> of DAI, which user expects to lock as a pledge, sending <code>pAmount</code> of PTK. Zero value is allowed.</li>
<li>Call <code>PToken.approve(FundsModule.address, pAmount)</code> to allow operation.</li>
<li>Call <code>LoanModule.addPledge(borrower, proposal, pAmount, lAmountMin)</code> to execute operation.</li>
</ol>
<h3 id="withdraw-pledge">Withdraw Pledge</h3>
<h4 id="required-data_5">Required data:</h4>
<ul>
<li>Loan proposal identifiers:</li>
<li><code>borrower</code> Address of borrower</li>
<li><code>proposal</code> Proposal index</li>
<li><code>pAmount</code>  Amount to withdraw, PTK</li>
</ul>
<h4 id="required-conditions_4">Required conditions:</h4>
<ul>
<li>Loan proposal created</li>
<li>Loan proposal not yet executed</li>
<li>User pledge amount &gt;= <code>pAmount</code></li>
</ul>
<h4 id="workflow_4">Workflow:</h4>
<ol>
<li>Call <code>LoanModule.withdrawPledge(borrower, proposal, pAmount)</code> to execute operation.</li>
</ol>
<h3 id="loan-issuance">Loan issuance</h3>
<h4 id="required-data_6">Required data:</h4>
<p><code>proposal</code> Proposal index</p>
<h4 id="required-conditions_5">Required conditions:</h4>
<ul>
<li>Loan proposal created, user (transaction sender) is the <code>borrower</code></li>
<li>Loan proposal not yet executed</li>
<li>Loan proposal is fully funded: <code>LoanModule.getRequiredPledge(borrower, proposal) == 0</code></li>
<li>Pool has enough liquidity</li>
</ul>
<h4 id="workflow_5">Workflow:</h4>
<ol>
<li>Call <code>LoanModule.executeDebtProposal(proposal)</code> to execute operation.</li>
</ol>
<h4 id="data-required-for-future-calls_1">Data required for future calls:</h4>
<ul>
<li>Loan index: <code>debtIdx</code> from event <code>DebtProposalExecuted</code>.</li>
</ul>
<h3 id="loan-repayment-partial-or-full">Loan repayment (partial or full)</h3>
<h4 id="required-data_7">Required data:</h4>
<ul>
<li><code>debt</code> Loan index</li>
<li><code>lAmount</code> Repayable amount, DAI</li>
</ul>
<h4 id="required-conditions_6">Required conditions:</h4>
<ul>
<li>User (transaction sender) is the borrower</li>
<li>Loan is not yet fully repaid</li>
</ul>
<h4 id="workflow_6">Workflow:</h4>
<ol>
<li>Call <code>LToken.approve(FundsModule.address, lAmount)</code> to allow operation.</li>
<li>Call <code>LoanModule.repay(debt, lAmount)</code> to execute operation.</li>
</ol>
<h2 id="distributions">Distributions</h2>
<p>When borrower repays some part of his loan, he uses some PTK (either from his balance or minted when he sends DAI to the pool).
This PTKs are distributed to supporters, proportionally to the part of the loan they covered. The borrower himself also covered half of the loan, and his part is distributed over the whole pool.
All users of the pool receive part of this distributions proportional to the amount of PTK they hold on their balance and in loan proposals, PTK locked as collateral for loans is not counted.
<img alt="Distributions" src="/images/development/akropolisos/diagram_distributions.png" /></p>
<h3 id="distribution-mechanics">Distribution mechanics</h3>
<p>When you need to distribute some amount of tokens over all token holders one's first straight-forward idea might be to iterate through all token holders, check their balance and increase it by their part of the distribution.
Unfortunately, this approach can hardly be used in Ethereum blockchain. All operations in EVM cost some gas. If we have a lot of token holders, gas cost for iteration through all may be higher than a gas limit for transaction (which is currently equal to gas limit for block).
Instead, during distribution we just store amount of PTK to be distributed and current amount of all PTK qualified for distribution. And user balance is only updated by separate request or when it is going to be changed by transfer, mint or burn. During this "lazy" update we go through all distributions occured between previous and current update.
Now, one may ask what if there is too much distributions occurred in the pool between this updated and the gas usage to iterate through all of them is too high again? Obvious solution would be to allow split such transaction to several smaller ones, and we've implemented this approach.
But we also decided to aggregate all distributions during a day. This way we can protect ourself from dust attacks, when somebody may do a lot of small repays which cause a lot of small distributions.
When a distribution request is received by PToken we check if it's time to actually create new distribution. If it's not, we just add distribution amount to the accumulator.
When time comes (and this condition is also checked by transfers, mints and burns), actual distribution is created using accumulated amount of PTK and total supply of qualified PTK.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../sparta/" title="Sparta" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Sparta
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/akropolisio" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/akropolis" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/akropolisio" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/akropolisio/" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://t.me/akropolis_official" class="md-footer-social__link fa fa-telegram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../js/init.js"></script>
      
    
  </body>
</html>